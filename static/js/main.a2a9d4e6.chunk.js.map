{"version":3,"sources":["pages/index.js","utils/source.js","index.js","assets/user.jpg"],"names":["HomePage","data","results","currentTime","Date","getTime","i","push","time","moment","format","msg","index","getChatSource","useState","slice","messages","setMessages","fistItemindex","setIndex","inputEl","useRef","lastOneEl","onButtonClick","current","focus","value","trim","concat","tag","document","getElementById","style","display","scrollIntoView","behavior","computedData","window","scrollY","useEffect","getData","func","wait","timeout","clearTimeout","setTimeout","debounce","addEventListener","removeEventListener","className","src","avatar","alt","map","item","arr","key","toString","length","id","height","ref","type","onKeyPress","e","nativeEvent","keyCode","placeholder","onClick","ReactDOM","render","module","exports"],"mappings":"0MA+FeA,MAzEf,WACI,IAAMC,ECrBmB,WAGzB,IAFA,IAAMC,EAAU,GACZC,GAAc,IAAIC,MAAOC,UAAY,IACjCC,EAAE,EAAEA,EAAE,IAAIA,IACdJ,EAAQK,KAAK,CAACC,KAAMC,IAAON,GAAaO,OAAO,SAAUC,IAAI,YAAD,OAAcL,GAAKM,MAAMN,IACrFH,IAGJ,OAAOD,EDaMW,GADG,EAEgBC,mBAASb,EAAKc,OAAO,IAFrC,mBAETC,EAFS,KAECC,EAFD,OAGkBH,mBAASE,EAAS,GAAGJ,OAHvC,mBAGTM,EAHS,KAGMC,EAHN,KAIVC,EAAUC,iBAAO,MACjBC,EAAYD,iBAAO,MAEnBE,EAAgB,WAClBH,EAAQI,QAAQC,QAChB,IAAItB,GAAc,IAAIC,MAAOC,UAAY,IACL,KAAjCe,EAAQI,QAAQE,MAAMC,QACrBV,EAAYD,EAASY,OAAO,CACxBpB,KAAKC,IAAON,GAAaO,OAAO,SAChCC,IAAI,GAAD,OAAKS,EAAQI,QAAQE,OACxBG,IAAI,UAGZC,SAASC,eAAe,iBAAiBC,MAAMC,QAAQ,QACvDX,EAAUE,QAAQU,eAAe,CAAEC,SAAU,WAC7CL,SAASC,eAAe,iBAAiBC,MAAMC,QAAQ,OACvDb,EAAQI,QAAQE,MAAQ,IAStBU,EAAe,WACK,IAAnBC,OAAOC,UACNrB,EAAYhB,EAAKc,MAAMG,EAAgB,EAAEA,GAAeU,OAAOZ,IAC/DG,EAASD,EAAgB,KAYjC,OARAqB,qBAAU,WACN,IAAMC,EArDd,SAAkBC,EAAMC,GACpB,IAAIC,EACJ,OAAO,WACHC,aAAaD,GACbA,EAAUE,WAAWJ,EAAMC,IAiDXI,CAASV,EAAa,KAEtC,OADAC,OAAOU,iBAAiB,SAAUP,GAAS,GACpC,WACLH,OAAOW,oBAAoB,SAAUR,GAAS,OAKhD,6BACI,4BAAQS,UAAU,kBACd,0BAAMA,UAAU,iBAAhB,KACA,yBAAKA,UAAU,iBACX,yBAAKC,IAAKC,IAAQC,IAAI,WAD1B,WAGA,0BAAMH,UAAU,iBAAhB,QAEJ,yBAAKA,UAAU,eAEPjC,EAASqC,KAAI,SAACC,EAAM1C,EAAO2C,GAAd,OACT,yBAAKC,IAAK5C,EAAM6C,WAAYR,UAAS,sBAAiBK,EAAKzB,IAAM,eAAgB,GAA5C,YAAkDjB,EAAQ,IAAM2C,EAAIG,OAAS,aAAe,KAC7H,yBAAKT,UAAU,eAAeK,EAAK9C,MACnC,yBAAKyC,UAAU,eAAeK,EAAK3C,SAI/C,yBAAKgD,GAAG,gBAAgB3B,MAAO,CAAC4B,OAAO,QAASC,IAAKvC,KAGzD,4BAAQ2B,UAAU,kBACd,2BAAOY,IAAKzC,EAAS0C,KAAK,OAAOC,WA3C1B,SAACC,GACa,KAA1BA,EAAEC,YAAYC,SACb3C,KAyC6D0B,UAAU,eAAekB,YAAY,YAC9F,4BAAQC,QAAS7C,EAAe0B,UAAU,iBAA1C,WEpFhBoB,IAASC,OACP,kBAAC,EAAD,MACAxC,SAASC,eAAe,U,kBCP1BwC,EAAOC,QAAU,IAA0B,kC","file":"static/js/main.a2a9d4e6.chunk.js","sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\r\nimport { getChatSource } from '../utils/source';\r\nimport moment from 'moment';\r\nimport avatar from '../assets/user.jpg';\r\nimport './index.css';\r\n\r\nfunction debounce(func, wait) {\r\n    var timeout;\r\n    return function () {\r\n        clearTimeout(timeout)\r\n        timeout = setTimeout(func, wait);\r\n    }\r\n}\r\n\r\n/**\r\n* call function within Transaction\r\n* @param {Function} onButtonClick 点击send,非空时发送数据,清空输入框,控制滚动条至最新消息;\r\n* @param {Function} onEnterKey 输入框enter发送数据,其它同上;\r\n* @param {Function} computedData 滚动时根据index获取需要展示的数据,默认滚动到头部时加载5条数据;\r\n* @param {Element} placeholderEL 发送数据时placeholderEL用来定位滚动问题,\r\n* 设置高度是因为底部输入框会遮挡最后一个信息,滚动后需要隐藏placeholderEL,否则滚动到底部会显示空白;\r\n*/\r\nfunction HomePage() {\r\n    const data = getChatSource();\r\n    const [messages, setMessages] = useState(data.slice(-5));\r\n    const [fistItemindex, setIndex] = useState(messages[0].index);\r\n    const inputEl = useRef(null);\r\n    const lastOneEl = useRef(null);\r\n\r\n    const onButtonClick = () => {\r\n        inputEl.current.focus();\r\n        let currentTime = new Date().getTime() - 10000000;\r\n        if(inputEl.current.value.trim() !== ''){\r\n            setMessages(messages.concat({\r\n                time:moment(currentTime).format(\"HH:MM\"), \r\n                msg: `${inputEl.current.value}`, \r\n                tag:'self'})\r\n            );\r\n        }\r\n        document.getElementById('placeholderEL').style.display='block';\r\n        lastOneEl.current.scrollIntoView({ behavior: \"smooth\" });\r\n        document.getElementById('placeholderEL').style.display='none';\r\n        inputEl.current.value = '';\r\n    };\r\n\r\n    const onEnterKey = (e) => {\r\n        if(e.nativeEvent.keyCode === 13){\r\n            onButtonClick();\r\n        }\r\n    };\r\n\r\n    const computedData = () => {\r\n        if(window.scrollY === 0){\r\n            setMessages(data.slice(fistItemindex - 5,fistItemindex).concat(messages));\r\n            setIndex(fistItemindex - 5);\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        const getData = debounce(computedData,1000);\r\n        window.addEventListener('scroll', getData, false)\r\n        return () => {\r\n          window.removeEventListener('scroll', getData, false)\r\n        }\r\n    })\r\n    \r\n    return (\r\n        <div>\r\n            <header className=\"header-wrapper\">\r\n                <span className=\"header-action\">&lt;</span>\r\n                <div className=\"header-avatar\">\r\n                    <img src={avatar} alt=\"avatar\" />Johnson\r\n                </div>\r\n                <span className=\"header-action\">...</span>\r\n            </header>\r\n            <div className=\"dialog-list\">\r\n                {\r\n                    messages.map((item, index, arr) => \r\n                        <div key={index.toString()} className={`dialog-item ${item.tag ? 'self-message': ''} ${index + 1 === arr.length ? 'last-child' : ''}`}>\r\n                            <div className=\"dialog-time\">{item.time}</div>\r\n                            <div className=\"dialog-text\">{item.msg}</div>\r\n                        </div>\r\n                    )\r\n                }\r\n                <div id=\"placeholderEL\" style={{height:'76pt'}} ref={lastOneEl}></div>\r\n            </div>\r\n\r\n            <footer className=\"footer-wrapper\">\r\n                <input ref={inputEl} type=\"text\" onKeyPress={onEnterKey} className=\"footer-input\" placeholder=\"Message\" />\r\n                <button onClick={onButtonClick} className=\"footer-button\">Send</button>\r\n            </footer>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default HomePage;","import moment from 'moment';\r\n\r\nexport const getChatSource = () => {\r\n    const results = [];\r\n    let currentTime = new Date().getTime() - 10000000;\r\n    for(let i=0;i<100;i++) {\r\n        results.push({time: moment(currentTime).format(\"HH:MM\"), msg: `Message \"${i}`, index:i});\r\n        currentTime++;\r\n    }\r\n\r\n    return results;\r\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport Home from './pages/index';\n\n\nReactDOM.render(\n  <Home />,\n  document.getElementById('root')\n);\n\n\n","module.exports = __webpack_public_path__ + \"static/media/user.bba63273.jpg\";"],"sourceRoot":""}